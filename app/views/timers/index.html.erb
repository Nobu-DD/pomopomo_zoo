<div class="min-h-screen">
  <div class="flex justify-center">
    <div class="flex justify-center relative w-50 text-[40px] bg-orange-500 text-white rounded-xl mt-20">
      <p id="timerNow" class="">25:00</p>
      <p id="" class="absolute right-1 bottom-0  text-3xl">0</p>
    </div>
  </div>
  <div class="flex justify-center mt-70">
    <input type="button" id="startStopButton" class="text-[40px] bg-red-500 w-50 text-white rounded-xl cursor-pointer" value="スタート">
  </div>
  <div class="flex relative mt-13">
    <%= link_to "トップ画面", "/", class: "absolute right-8 inline-block text-center text-[40px] bg-yellow-500 w-60 text-white rounded-xl cursor-pointer"%>
  </div>
</div>
<script>
  // スタート、ストップボタン(input)を定数に代入
  const start_stop_button = document.querySelector("#startStopButton");
  // タイマー画面に表示される時間
  let timerNow = document.querySelector("#timerNow")
  // 最初にスタートボタンを押した時のミリ秒
  let startTime;
  // ポモタイマーストップ、再開するためのインターバルid
  let nIntervId;
  // ポモ中断時の変数
  let breakTime;
  // ポモ残り時間
  let remainingTime = 1500000;

  // timeにはポモドーロの残り時間(ミリ秒)が代入される
  const msecToSecString = (time) => {
    // ミリ秒から秒に変換。コンマは必要ないのでMath.floorで切り捨て
    time = Math.floor(time/1000);

    const seconds = time % 60;
    const minutes = Math.floor(time / 60);

    secondStr = (seconds < 10 ? "0" : "" ) + String(seconds);
    minuteStr = (minutes < 10 ? "0" : "" ) + String(minutes);

    return minuteStr + ":" + secondStr;
  }
  // スタート時間と現在時間の経過を計算する関数
  const timerCount = () => {
    nowTime = new Date().getTime();
    remainingTime = startTime - nowTime;
    timerNow.innerHTML = msecToSecString(remainingTime);
  }

  // タイマーのボタンを押した時の処理を記述する
  const timerSwitch = () => {
    if (start_stop_button.value === "スタート"){
      start_stop_button.value = "ストップ";
      startTime = new Date().getTime() + remainingTime;
      nIntervId = setInterval(timerCount,1000);
    } else {
      // ストップを押した時の処理
      start_stop_button.value = "スタート";
      clearInterval(nIntervId);
    };
  };

  // スタート、ストップボタンが押された時の処理
  start_stop_button.addEventListener('click', timerSwitch);

</script>

<%# <%= javascript_path "timer" %>